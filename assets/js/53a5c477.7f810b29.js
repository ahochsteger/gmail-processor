"use strict";(self.webpackChunkgmail_processor_docs=self.webpackChunkgmail_processor_docs||[]).push([[3866],{7126:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>h});var a=t(4848),n=t(8453),i=t(4153),r=t(5696);const o={id:"simple",title:"Simple"},c=void 0,l={id:"examples/basics/simple",title:"Simple",description:"\x3c!--",source:"@site/docs/examples/basics/simple.mdx",sourceDirName:"examples/basics",slug:"/examples/basics/simple",permalink:"/gmail-processor/docs/examples/basics/simple",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/examples/basics/simple.mdx",tags:[],version:"current",frontMatter:{id:"simple",title:"Simple"},sidebar:"docsSidebar",previous:{title:"Basics",permalink:"/gmail-processor/docs/examples/basics/"},next:{title:"Features",permalink:"/gmail-processor/docs/examples/features/"}},d={},h=[];function m(e){const s={a:"a",code:"code",li:"li",p:"p",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.p,{children:"This is a simple example to start with Gmail Processor."}),"\n",(0,a.jsxs)(s.p,{children:["There's one ",(0,a.jsx)(s.strong,{children:"critical decision"})," to be taken about how threads or messages should be marked as processed to prevent multiple processing."]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:[(0,a.jsx)(s.code,{children:"mark-read"}),":"]})," Mark processed messages as read. This is the recommended method to get started, because it also can deal with multiple messages per thread.","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"PROS: Can process additional messages within the same thread even after a thread has already been processed."}),"\n",(0,a.jsx)(s.li,{children:"CONS: Marks the processed messages as read, which may not be what you want to have."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:[(0,a.jsx)(s.code,{children:"add-label"}),":"]})," Mark processed threads by attaching the label configured using ",(0,a.jsx)(s.code,{children:"markProcessedLabel"}),". This is recommended for simple cases with just a single message in each processed thread.","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"PROS: Keeps processed messages in an unread state."}),"\n",(0,a.jsx)(s.li,{children:"CONS: Cannot process additional messages that may be added after a thread has already been processed."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.strong,{children:[(0,a.jsx)(s.code,{children:"custom"}),":"]}),": Leaves the decision on how to remember processed threads/messages to the user of the library using certain actions.","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["PROS: Most flexible, can deal with many edge cases using one of the many actions (e.g. ",(0,a.jsx)(s.code,{children:"moveToArchive"}),", ",(0,a.jsx)(s.code,{children:"moveToTrash"}),", ",(0,a.jsx)(s.code,{children:"star"}),", ",(0,a.jsx)(s.code,{children:"markRead"}),", ",(0,a.jsx)(s.code,{children:"markImportant"}),", ",(0,a.jsx)(s.code,{children:"addLabel"}),")"]}),"\n",(0,a.jsx)(s.li,{children:"CONS: Great care has to be taken that the matching configuration and the actions to mark entities as processed fit together. Otherwise they may get processed over and over again."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"You can put match configs which should m\nThe primary configuration resides in a nested list of config structures with the following parts:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"threads"}),":","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Defines which threads should be queried and matched in the ",(0,a.jsx)(s.code,{children:"match"})," section."]}),"\n",(0,a.jsxs)(s.li,{children:["Defines which actions should be executed for matching threads in the ",(0,a.jsx)(s.code,{children:"actions"})," section."]}),"\n",(0,a.jsxs)(s.li,{children:["Delegates processing of further messages to the ",(0,a.jsx)(s.code,{children:"messages"})," section."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"messages"}),":","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Defines which messages should be matched in the ",(0,a.jsx)(s.code,{children:"match"})," section."]}),"\n",(0,a.jsxs)(s.li,{children:["Defines which actions should be executed for matching messages in the ",(0,a.jsx)(s.code,{children:"actions"})," section."]}),"\n",(0,a.jsxs)(s.li,{children:["Delegates processing of further attachments to the ",(0,a.jsx)(s.code,{children:"attachments"})," section."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"attachments"}),":","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Defines which attachments should be matched in the ",(0,a.jsx)(s.code,{children:"match"})," section."]}),"\n",(0,a.jsxs)(s.li,{children:["Defines which actions should be executed for matching attachments in the ",(0,a.jsx)(s.code,{children:"actions"})," section."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Matches or actions that should always be taken into account for every thread/message/attachment can be put into the global section."}),"\n",(0,a.jsx)(s.p,{children:"This example uses a global thread match query to ensure only threads that comply to these criteria should be processed:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"has attachments"}),"\n",(0,a.jsx)(s.li,{children:"is not in trash"}),"\n",(0,a.jsx)(s.li,{children:"is not in spam"}),"\n",(0,a.jsx)(s.li,{children:"is not a draft"}),"\n",(0,a.jsx)(s.li,{children:"contains messages after a certain date"}),"\n",(0,a.jsx)(s.li,{children:"contains messages with a certain subject"}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["The processing continues by restricting the query to threads where the user is the sender.\nSince the messages section does not have any additional matcher, all messages in the thread will be processed.\nIn the attachments section the ",(0,a.jsx)(s.code,{children:"match"})," section restricts processing to attachments that have the name ",(0,a.jsx)(s.code,{children:"invoice.pdf"})," using a regular expression.\nMatching attachments will then be stored at the given location using ",(0,a.jsx)(s.a,{href:"https://ahochsteger.github.io/gmail-processor/docs/reference/placeholder",children:"placeholder substitution"})," to dynamically create the location based on thread/message/attachment data."]}),"\n",(0,a.jsx)(r.A,{path:"src/examples/basics/simple.ts",example:i.B3})]})}function u(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},5696:(e,s,t)=>{t.d(s,{A:()=>m});var a=t(8774),n=t(1432),i=t(9365),r=t(1470),o=(t(6540),t(4848));const c="https://github.com/ahochsteger/gmail-processor/blob/main/src/examples",l="https://github.com/ahochsteger/gmail-processor/issues",d="https://github.com/ahochsteger/gmail-processor/pull";function h(e,s,t){let a=[];return t&&t.length>0&&(a=[(0,o.jsxs)("span",{children:[" (",e,": "]},`${e}-0`)].concat(t?.map(((e,t,a)=>(0,o.jsxs)("span",{children:[(0,o.jsxs)("a",{href:`${s}/${e}`,children:["#",e]}),t<a.length-1?",":""]},e)))),a.push((0,o.jsx)("span",{children:")"}))),a}function m(e){let{example:s}=e;const t=s.info,m=`${s.info.category}/${s.info.name}.ts`,u=s.config,g=`${t.name}.ts`;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("p",{children:["\ud83d\udc49 Edit this example in the ",(0,o.jsx)(a.A,{href:`/playground?example=${t.name}`,children:"playground"}),"v1"===t.schemaVersion?" and automatically migrate it to the v2 format using the convert button":"","."]}),(0,o.jsxs)(r.default,{children:[(0,o.jsx)(i.default,{value:"config",label:"Config",default:!0,children:(0,o.jsx)(n.default,{language:"jsx",showLineNumbers:!0,children:JSON.stringify(u,null,2)})}),(0,o.jsx)(i.default,{value:"script",label:"Script",children:(0,o.jsx)(n.default,{language:"jsx",showLineNumbers:!0,children:"v1"===t.schemaVersion?'function migrateConfig() {"{"}\n  const oldConfig = {JSON.stringify(config,null,2)}\n  const migratedConfig = GmailProcessorLib.convertV1Config(oldConfig)\n  console.log(JSON.stringify(migratedConfig, null, 2))\n}':`function run() {\n  const config = ${JSON.stringify(u,null,2).split("\n").map((e=>`  ${e}`)).join("\n").trim()}\n  GmailProcessorLib.run(config, GmailProcessorLib.RunMode.DRY_RUN)\n}`})})]}),(0,o.jsxs)("p",{children:["Source: ",(0,o.jsx)("a",{href:`${c}/${m}`,children:g}),h("Issues",l,s.info.issues),h("PRs",d,s.info.pullRequests)]})]})}},4153:(e,s,t)=>{t.d(s,{B3:()=>c});t(2744);var a=t(7216),n=t(6407),i=t(7694);const r={name:"simple",title:"Simple",description:"This is a simple example to start with Gmail Processor.",category:"basics",generate:["docs","test-e2e","test-spec"],schemaVersion:"v2"},o={description:r.description,settings:{markProcessedMethod:n.Pn.MARK_MESSAGE_READ},global:{thread:{match:{query:`has:attachment -in:trash -in:drafts -in:spam after:\${date.now:date::yyyy-MM-dd} subject:'${i.L.EMAIL_SUBJECT_PREFIX}${r.name}'`}}},threads:[{match:{query:"from:${user.email}"},messages:[{attachments:[{match:{name:"^invoice\\.pdf$"},actions:[{name:"attachment.store",args:{location:`${i.L.DRIVE_TESTS_BASE_PATH}/${r.name}/\${message.date:date::yyyy-MM-dd}/\${message.subject}-\${attachment.name}`,conflictStrategy:a.c2.KEEP}}]}]}]}]},c={info:r,config:o}},2744:(e,s,t)=>{t.d(s,{Ah:()=>n,GS:()=>r,KI:()=>i,jV:()=>a});let a=function(e){return e.DRY_RUN="dry-run",e.SAFE_MODE="safe-mode",e.DANGEROUS="dangerous",e}({}),n=function(e){return e.BOOLEAN="boolean",e.DATE="date",e.NUMBER="number",e.STRING="string",e.VARIABLE="variable",e}({});function i(e,s,t,a,n){return{deprecationInfo:n,description:a,title:t,type:e,value:s}}let r=function(e){return e.ERROR="error",e.OK="ok",e}({});Error},7216:(e,s,t)=>{t.d(s,{c2:()=>q});t(2744);var a=t(3359),n=t(7937),i=t(8118),r=t(8828),o=t(3380),c=t(5449),l=t(120),d=t(7736),h=t(575),m=t(7890),u=t(1634),g=t(8220),p=t(7102),f=t(738),x=t(9259),j=t(8305),A=t(506),b=t(1827),y=t(3757),v=t(8772),k=t(9596),S=t(8655),E=t(8016),R=t(655),T=t(2497),M=t(721),$=t(4313),w=t(7036),_=t(6143),L=t(7072),P=t(783),O=t(9953),D=t(9678),I=t(9113),N=t(8275),C=t(6191),U=t(2685),G=t(2950),V=t(2469),B=t(399),F=t(2163),J=t(7569),K=t(8375),H=t(6898);t(2882),t(5067),t(3711);a.A,n.A,i.A,r.A,o.A,c.A,l.A,d.A,h.A,m.A,u.A,g.A,p.A,f.A,x.A,j.A,A.A,b.A,y.A,v.A,k.A,S.A,E.A,R.A,T.A,M.A,$.A,w.A,_.A,L.A,P.A,O.A,D.A,I.A,N.A,C.A,U.A,G.A,V.A,B.A,F.A,J.A,K.A,H.A;let q=function(e){return e.BACKUP="backup",e.ERROR="error",e.KEEP="keep",e.REPLACE="replace",e.SKIP="skip",e.UPDATE="update",e}({})},6407:(e,s,t)=>{t.d(s,{GJ:()=>u,Pn:()=>d,c1:()=>p,we:()=>g});var a=t(4729),n=t(4467),i=t(8420),r=t(5136),o=t(5698),c=(t(5508),t(7158)),l=t(9361);let d=function(e){return e.ADD_THREAD_LABEL="add-label",e.CUSTOM="custom",e.MARK_MESSAGE_READ="mark-read",e}({});class h{constructor(){(0,n.A)(this,"name",""),(0,n.A)(this,"title",""),(0,n.A)(this,"value",void 0),(0,n.A)(this,"ctxValues",{})}}let m=function(e){return e.NONE="none",e.AUTO="auto",e.ALL="all",e}({}),u=(0,a.A)(null,(function(e){return{F:class{constructor(){e(this)}},d:[{kind:"field",key:"defaultTimestampFormat",value:()=>"yyyy-MM-dd HH:mm:ss"},{kind:"field",key:"defaultArrayJoinSeparator",value:()=>","},{kind:"field",decorators:[(0,i.v)()],key:"logSheetLocation",value:()=>""},{kind:"field",decorators:[(0,i.v)()],key:"logFields",value:()=>["log.timestamp","log.level","log.location","log.message","object.id","object.date","object.subject","object.from","object.url","attachment.name","attachment.size","attachment.contentType","stored.location","stored.url","stored.downloadUrl"]},{kind:"field",decorators:[(0,i.v)(),(0,r.Z)((()=>h))],key:"logConfig",value:()=>[{name:"log.timestamp",title:"Timestamp",value:"${date.now:date::yyyy-MM-dd HH:mm:ss.SSS}"},{name:"log.level",title:"Log Level"},{name:"log.message",title:"Log Message"},{name:"context.type",title:"Context Type"},{name:"object.id",title:"ID",ctxValues:{attachment:"${attachment.hash}",message:"${message.id}",thread:"${thread.id}"}},{name:"object.url",title:"GMail URL",ctxValues:{attachment:"${message.url}",message:"${message.url}",thread:"${thread.url}"}},{name:"object.date",title:"Message Date",ctxValues:{attachment:"${message.date}",message:"${message.date}",thread:"${thread.lastMessageDate}"}},{name:"object.subject",title:"Subject",ctxValues:{attachment:"${message.subject}",message:"${message.subject}",thread:"${thread.firstMessageSubject}"}},{name:"object.from",title:"From",ctxValues:{attachment:"${message.from}",message:"${message.from}"}},{name:"attachment.name",title:"Attachment Name"},{name:"attachment.contentType",title:"Content Type"},{name:"attachment.size",title:"Attachment Size"},{name:"stored.location",title:"Stored Location",ctxValues:{attachment:"${attachment.stored.location}"}},{name:"stored.url",title:"Stored URL",ctxValues:{attachment:"${attachment.stored.url}"}},{name:"stored.downloadUrl",title:"Download URL",ctxValues:{attachment:"${attachment.stored.downloadUrl}"}}]},{kind:"field",key:"logLevel",value:()=>l.$.INFO},{kind:"field",key:"logSensitiveRedactionMode",value:()=>m.AUTO},{kind:"field",key:"logSheetTracing",value:()=>!1},{kind:"field",decorators:[(0,i.v)()],key:"maxBatchSize",value:()=>10},{kind:"field",decorators:[(0,i.v)()],key:"maxRuntime",value:()=>280},{kind:"field",decorators:[(0,i.v)()],key:"markProcessedLabel",value:()=>""},{kind:"field",decorators:[(0,i.v)()],key:"markProcessedMethod",value:()=>d.MARK_MESSAGE_READ},{kind:"field",decorators:[(0,i.v)()],key:"sleepTimeThreads",value:()=>100},{kind:"field",decorators:[(0,i.v)()],key:"sleepTimeMessages",value:()=>0},{kind:"field",decorators:[(0,i.v)()],key:"sleepTimeAttachments",value:()=>0},{kind:"field",decorators:[(0,i.v)()],key:"timezone",value:()=>"default"}]}}));function g(e){return void 0===e&&(e={}),(0,o.bj)(u,e,{exposeDefaultValues:!0,exposeUnsetFields:!1})}function p(e){return e=(0,c.I)(e,g(),{},["markProcessedMethod"])}},7694:(e,s,t)=>{t.d(s,{L:()=>n});var a=t(4467);class n{}(0,a.A)(n,"DRIVE_TESTS_BASE_PATH","/GmailProcessor-Tests/e2e"),(0,a.A)(n,"EMAIL_SLEEP_TIME_MS",1e4),(0,a.A)(n,"EMAIL_SUBJECT_PREFIX","[GmailProcessor-Test] "),(0,a.A)(n,"GIT_REPO_BASE_URL","https://raw.githubusercontent.com/ahochsteger/gmail-processor"),(0,a.A)(n,"GIT_REPO_BRANCH","main"),(0,a.A)(n,"GIT_REPO_TEST_FILES_PATH","src/e2e-test/files")},7158:(e,s,t)=>{function a(e,s,t,a){return void 0===t&&(t={}),void 0===a&&(a=[]),a=a.concat([]),Object.keys(e).forEach((n=>{const i=function(e,s){return Array.isArray(e)&&s?e=e.map((e=>s(e))):"object"==typeof e&&s&&(e=s(e)),e}(e[n],t[n]),r=JSON.stringify(i);a.includes(n)||null!==i&&r!==JSON.stringify(s[n])&&"[]"!==r&&"{}"!==r||delete e[n]})),e}t.d(s,{I:()=>a})},9361:(e,s,t)=>{t.d(s,{$:()=>a});t(6407);let a=function(e){return e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});Object.values(a)}}]);